"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadRuntimeConfig = loadRuntimeConfig;
exports.validateRuntimeConfig = validateRuntimeConfig;
exports.createTestConfig = createTestConfig;
/**
 * Load runtime configuration from environment variables
 */
function loadRuntimeConfig() {
    const requiredEnvVars = [
        'MESSAGES_TABLE',
        'LEADS_TABLE',
        'BEDROCK_MODEL_ID',
        'AWS_REGION',
    ];
    // Optional environment variables
    const optionalEnvVars = [
        'PERSONAS_TABLE',
    ];
    // Check for required environment variables
    for (const envVar of requiredEnvVars) {
        if (!process.env[envVar]) {
            throw new Error(`Missing required environment variable: ${envVar}`);
        }
    }
    return {
        messagesTable: process.env.MESSAGES_TABLE,
        leadsTable: process.env.LEADS_TABLE,
        personasTable: process.env.PERSONAS_TABLE,
        bedrockModelId: process.env.BEDROCK_MODEL_ID,
        outboundEventBusName: process.env.OUTBOUND_EVENT_BUS_NAME,
        outboundEventBusArn: process.env.OUTBOUND_EVENT_BUS_ARN,
        eventBusPutEventsRoleArn: process.env.EVENT_BUS_PUT_EVENTS_ROLE_ARN,
        ragIndexNamePrefix: process.env.RAG_INDEX_NAME_PREFIX || 'kxgen_',
        historyLimit: parseInt(process.env.HISTORY_LIMIT || '50', 10),
        awsRegion: process.env.AWS_REGION,
        dynamodbEndpoint: process.env.DYNAMODB_ENDPOINT, // for local development
    };
}
/**
 * Validate runtime configuration
 */
function validateRuntimeConfig(config) {
    if (!config.messagesTable) {
        throw new Error('messagesTable is required');
    }
    if (!config.leadsTable) {
        throw new Error('leadsTable is required');
    }
    if (!config.bedrockModelId) {
        throw new Error('bedrockModelId is required');
    }
    if (!config.awsRegion) {
        throw new Error('awsRegion is required');
    }
    if (config.historyLimit < 1 || config.historyLimit > 1000) {
        throw new Error('historyLimit must be between 1 and 1000');
    }
}
/**
 * Create a test configuration for local development
 */
function createTestConfig(overrides = {}) {
    return {
        messagesTable: 'test-messages',
        leadsTable: 'test-leads',
        bedrockModelId: 'anthropic.claude-3-sonnet-20240229-v1:0',
        outboundEventBusName: 'test-event-bus',
        ragIndexNamePrefix: 'test_kxgen_',
        historyLimit: 50,
        awsRegion: 'us-east-1',
        dynamodbEndpoint: 'http://localhost:8000',
        ...overrides,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9jb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFLQSw4Q0FpQ0M7QUFLRCxzREFvQkM7QUFLRCw0Q0FZQztBQTlFRDs7R0FFRztBQUNILFNBQWdCLGlCQUFpQjtJQUMvQixNQUFNLGVBQWUsR0FBRztRQUN0QixnQkFBZ0I7UUFDaEIsYUFBYTtRQUNiLGtCQUFrQjtRQUNsQixZQUFZO0tBQ2IsQ0FBQztJQUVGLGlDQUFpQztJQUNqQyxNQUFNLGVBQWUsR0FBRztRQUN0QixnQkFBZ0I7S0FDakIsQ0FBQztJQUVGLDJDQUEyQztJQUMzQyxLQUFLLE1BQU0sTUFBTSxJQUFJLGVBQWUsRUFBRSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDekIsTUFBTSxJQUFJLEtBQUssQ0FBQywwQ0FBMEMsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUN0RSxDQUFDO0lBQ0gsQ0FBQztJQUVELE9BQU87UUFDTCxhQUFhLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFlO1FBQzFDLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVk7UUFDcEMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYztRQUN6QyxjQUFjLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBaUI7UUFDN0Msb0JBQW9CLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUI7UUFDekQsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0I7UUFDdkQsd0JBQXdCLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkI7UUFDbkUsa0JBQWtCLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsSUFBSSxRQUFRO1FBQ2pFLFlBQVksRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLElBQUksSUFBSSxFQUFFLEVBQUUsQ0FBQztRQUM3RCxTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFXO1FBQ2xDLGdCQUFnQixFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsd0JBQXdCO0tBQzFFLENBQUM7QUFDSixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixxQkFBcUIsQ0FBQyxNQUFxQjtJQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzFCLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN2QixNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDM0IsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsSUFBSSxNQUFNLENBQUMsWUFBWSxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsWUFBWSxHQUFHLElBQUksRUFBRSxDQUFDO1FBQzFELE1BQU0sSUFBSSxLQUFLLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUM3RCxDQUFDO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsZ0JBQWdCLENBQUMsWUFBb0MsRUFBRTtJQUNyRSxPQUFPO1FBQ0wsYUFBYSxFQUFFLGVBQWU7UUFDOUIsVUFBVSxFQUFFLFlBQVk7UUFDeEIsY0FBYyxFQUFFLHlDQUF5QztRQUN6RCxvQkFBb0IsRUFBRSxnQkFBZ0I7UUFDdEMsa0JBQWtCLEVBQUUsYUFBYTtRQUNqQyxZQUFZLEVBQUUsRUFBRTtRQUNoQixTQUFTLEVBQUUsV0FBVztRQUN0QixnQkFBZ0IsRUFBRSx1QkFBdUI7UUFDekMsR0FBRyxTQUFTO0tBQ2IsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFJ1bnRpbWVDb25maWcgfSBmcm9tICcuLi90eXBlcy9pbmRleC5qcyc7XG5cbi8qKlxuICogTG9hZCBydW50aW1lIGNvbmZpZ3VyYXRpb24gZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRSdW50aW1lQ29uZmlnKCk6IFJ1bnRpbWVDb25maWcge1xuICBjb25zdCByZXF1aXJlZEVudlZhcnMgPSBbXG4gICAgJ01FU1NBR0VTX1RBQkxFJyxcbiAgICAnTEVBRFNfVEFCTEUnLFxuICAgICdCRURST0NLX01PREVMX0lEJyxcbiAgICAnQVdTX1JFR0lPTicsXG4gIF07XG5cbiAgLy8gT3B0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gIGNvbnN0IG9wdGlvbmFsRW52VmFycyA9IFtcbiAgICAnUEVSU09OQVNfVEFCTEUnLFxuICBdO1xuXG4gIC8vIENoZWNrIGZvciByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgZm9yIChjb25zdCBlbnZWYXIgb2YgcmVxdWlyZWRFbnZWYXJzKSB7XG4gICAgaWYgKCFwcm9jZXNzLmVudltlbnZWYXJdKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgcmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGU6ICR7ZW52VmFyfWApO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgbWVzc2FnZXNUYWJsZTogcHJvY2Vzcy5lbnYuTUVTU0FHRVNfVEFCTEUhLFxuICAgIGxlYWRzVGFibGU6IHByb2Nlc3MuZW52LkxFQURTX1RBQkxFISxcbiAgICBwZXJzb25hc1RhYmxlOiBwcm9jZXNzLmVudi5QRVJTT05BU19UQUJMRSxcbiAgICBiZWRyb2NrTW9kZWxJZDogcHJvY2Vzcy5lbnYuQkVEUk9DS19NT0RFTF9JRCEsXG4gICAgb3V0Ym91bmRFdmVudEJ1c05hbWU6IHByb2Nlc3MuZW52Lk9VVEJPVU5EX0VWRU5UX0JVU19OQU1FLFxuICAgIG91dGJvdW5kRXZlbnRCdXNBcm46IHByb2Nlc3MuZW52Lk9VVEJPVU5EX0VWRU5UX0JVU19BUk4sXG4gICAgZXZlbnRCdXNQdXRFdmVudHNSb2xlQXJuOiBwcm9jZXNzLmVudi5FVkVOVF9CVVNfUFVUX0VWRU5UU19ST0xFX0FSTixcbiAgICByYWdJbmRleE5hbWVQcmVmaXg6IHByb2Nlc3MuZW52LlJBR19JTkRFWF9OQU1FX1BSRUZJWCB8fCAna3hnZW5fJyxcbiAgICBoaXN0b3J5TGltaXQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LkhJU1RPUllfTElNSVQgfHwgJzUwJywgMTApLFxuICAgIGF3c1JlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiEsXG4gICAgZHluYW1vZGJFbmRwb2ludDogcHJvY2Vzcy5lbnYuRFlOQU1PREJfRU5EUE9JTlQsIC8vIGZvciBsb2NhbCBkZXZlbG9wbWVudFxuICB9O1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHJ1bnRpbWUgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVSdW50aW1lQ29uZmlnKGNvbmZpZzogUnVudGltZUNvbmZpZyk6IHZvaWQge1xuICBpZiAoIWNvbmZpZy5tZXNzYWdlc1RhYmxlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdtZXNzYWdlc1RhYmxlIGlzIHJlcXVpcmVkJyk7XG4gIH1cbiAgXG4gIGlmICghY29uZmlnLmxlYWRzVGFibGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2xlYWRzVGFibGUgaXMgcmVxdWlyZWQnKTtcbiAgfVxuICBcbiAgaWYgKCFjb25maWcuYmVkcm9ja01vZGVsSWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2JlZHJvY2tNb2RlbElkIGlzIHJlcXVpcmVkJyk7XG4gIH1cbiAgXG4gIGlmICghY29uZmlnLmF3c1JlZ2lvbikge1xuICAgIHRocm93IG5ldyBFcnJvcignYXdzUmVnaW9uIGlzIHJlcXVpcmVkJyk7XG4gIH1cbiAgXG4gIGlmIChjb25maWcuaGlzdG9yeUxpbWl0IDwgMSB8fCBjb25maWcuaGlzdG9yeUxpbWl0ID4gMTAwMCkge1xuICAgIHRocm93IG5ldyBFcnJvcignaGlzdG9yeUxpbWl0IG11c3QgYmUgYmV0d2VlbiAxIGFuZCAxMDAwJyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYSB0ZXN0IGNvbmZpZ3VyYXRpb24gZm9yIGxvY2FsIGRldmVsb3BtZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUZXN0Q29uZmlnKG92ZXJyaWRlczogUGFydGlhbDxSdW50aW1lQ29uZmlnPiA9IHt9KTogUnVudGltZUNvbmZpZyB7XG4gIHJldHVybiB7XG4gICAgbWVzc2FnZXNUYWJsZTogJ3Rlc3QtbWVzc2FnZXMnLFxuICAgIGxlYWRzVGFibGU6ICd0ZXN0LWxlYWRzJyxcbiAgICBiZWRyb2NrTW9kZWxJZDogJ2FudGhyb3BpYy5jbGF1ZGUtMy1zb25uZXQtMjAyNDAyMjktdjE6MCcsXG4gICAgb3V0Ym91bmRFdmVudEJ1c05hbWU6ICd0ZXN0LWV2ZW50LWJ1cycsXG4gICAgcmFnSW5kZXhOYW1lUHJlZml4OiAndGVzdF9reGdlbl8nLFxuICAgIGhpc3RvcnlMaW1pdDogNTAsXG4gICAgYXdzUmVnaW9uOiAndXMtZWFzdC0xJyxcbiAgICBkeW5hbW9kYkVuZHBvaW50OiAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJyxcbiAgICAuLi5vdmVycmlkZXMsXG4gIH07XG59XG4iXX0=