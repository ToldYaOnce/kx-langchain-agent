"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AgentTraceEventSchema = exports.AgentErrorEventSchema = exports.AgentReplyEventSchema = exports.InboundMessageEventSchema = exports.LeadItemSchema = exports.MessageItemSchema = exports.ChannelContextSchema = exports.ChatChannelContextSchema = exports.EmailChannelContextSchema = exports.SmsChannelContextSchema = exports.MessageDirectionSchema = exports.MessageSourceSchema = void 0;
const zod_1 = require("zod");
// Message source types
exports.MessageSourceSchema = zod_1.z.enum(['sms', 'email', 'chat', 'api', 'agent']);
// Message direction types
exports.MessageDirectionSchema = zod_1.z.enum(['inbound', 'outbound']);
// Channel context schemas
exports.SmsChannelContextSchema = zod_1.z.object({
    from: zod_1.z.string(),
    to: zod_1.z.string(),
    messageId: zod_1.z.string().optional(),
});
exports.EmailChannelContextSchema = zod_1.z.object({
    from: zod_1.z.string(),
    to: zod_1.z.string(),
    msgId: zod_1.z.string().optional(),
    threadId: zod_1.z.string().optional(),
});
exports.ChatChannelContextSchema = zod_1.z.object({
    sessionId: zod_1.z.string(),
    clientId: zod_1.z.string().optional(),
    userAgent: zod_1.z.string().optional(),
    ipAddress: zod_1.z.string().optional(),
});
exports.ChannelContextSchema = zod_1.z.object({
    sms: exports.SmsChannelContextSchema.optional(),
    email: exports.EmailChannelContextSchema.optional(),
    chat: exports.ChatChannelContextSchema.optional(),
});
// Message item schema for DynamoDB
exports.MessageItemSchema = zod_1.z.object({
    contact_pk: zod_1.z.string(), // {tenantId}#{email_lc}
    ts: zod_1.z.string(), // ISO8601 or ULID
    tenantId: zod_1.z.string(),
    email_lc: zod_1.z.string(),
    lead_id: zod_1.z.string().optional(),
    source: exports.MessageSourceSchema,
    direction: exports.MessageDirectionSchema,
    channel_context: exports.ChannelContextSchema.optional(),
    text: zod_1.z.string(),
    attachments: zod_1.z.array(zod_1.z.string()).optional(), // S3 URIs
    meta: zod_1.z.record(zod_1.z.any()).optional(),
    conversation_id: zod_1.z.string().optional(),
    // GSI attributes
    GSI1PK: zod_1.z.string().optional(), // tenantId for recent messages
    GSI1SK: zod_1.z.string().optional(), // ts
    GSI2PK: zod_1.z.string().optional(), // lead_id
    GSI2SK: zod_1.z.string().optional(), // ts
});
// Lead item schema (existing table)
exports.LeadItemSchema = zod_1.z.object({
    PK: zod_1.z.string(), // tenantId
    SK: zod_1.z.string(), // email_lc
    lead_id: zod_1.z.string(),
    email: zod_1.z.string(),
    email_lc: zod_1.z.string(),
    phone_e164: zod_1.z.string().optional(),
    preferences: zod_1.z.record(zod_1.z.any()).optional(),
});
// Event schemas for EventBridge
exports.InboundMessageEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.messaging'),
    'detail-type': zod_1.z.literal('lead.message.created'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        email_lc: zod_1.z.string().optional(),
        phone_e164: zod_1.z.string().optional(),
        lead_id: zod_1.z.string().optional(),
        source: exports.MessageSourceSchema,
        text: zod_1.z.string(),
        conversation_id: zod_1.z.string().optional(),
        provider: zod_1.z.record(zod_1.z.any()).optional(),
        timestamps: zod_1.z.object({
            received: zod_1.z.string(),
            processed: zod_1.z.string().optional(),
        }),
        channel_context: exports.ChannelContextSchema.optional(),
    }),
});
exports.AgentReplyEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.agent'),
    'detail-type': zod_1.z.literal('agent.reply.created'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        contact_pk: zod_1.z.string(),
        preferredChannel: exports.MessageSourceSchema,
        text: zod_1.z.string(),
        routing: zod_1.z.object({
            sms: zod_1.z.object({ to: zod_1.z.string() }).optional(),
            email: zod_1.z.object({ to: zod_1.z.string() }).optional(),
            chat: zod_1.z.object({ sessionId: zod_1.z.string() }).optional(),
        }),
        conversation_id: zod_1.z.string().optional(),
        metadata: zod_1.z.record(zod_1.z.any()).optional(),
    }),
});
exports.AgentErrorEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.agent'),
    'detail-type': zod_1.z.literal('agent.error'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        contact_pk: zod_1.z.string().optional(),
        error: zod_1.z.string(),
        stack: zod_1.z.string().optional(),
        context: zod_1.z.record(zod_1.z.any()).optional(),
    }),
});
exports.AgentTraceEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.agent'),
    'detail-type': zod_1.z.literal('agent.trace'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        contact_pk: zod_1.z.string().optional(),
        operation: zod_1.z.string(),
        duration_ms: zod_1.z.number().optional(),
        metadata: zod_1.z.record(zod_1.z.any()).optional(),
    }),
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdHlwZXMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkJBQXdCO0FBRXhCLHVCQUF1QjtBQUNWLFFBQUEsbUJBQW1CLEdBQUcsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0FBR3BGLDBCQUEwQjtBQUNiLFFBQUEsc0JBQXNCLEdBQUcsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBR3RFLDBCQUEwQjtBQUNiLFFBQUEsdUJBQXVCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUM5QyxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNoQixFQUFFLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNkLFNBQVMsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQ2pDLENBQUMsQ0FBQztBQUVVLFFBQUEseUJBQXlCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNoRCxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNoQixFQUFFLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNkLEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQzVCLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQ2hDLENBQUMsQ0FBQztBQUVVLFFBQUEsd0JBQXdCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUMvQyxTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNyQixRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUMvQixTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUNoQyxTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtDQUNqQyxDQUFDLENBQUM7QUFFVSxRQUFBLG9CQUFvQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDM0MsR0FBRyxFQUFFLCtCQUF1QixDQUFDLFFBQVEsRUFBRTtJQUN2QyxLQUFLLEVBQUUsaUNBQXlCLENBQUMsUUFBUSxFQUFFO0lBQzNDLElBQUksRUFBRSxnQ0FBd0IsQ0FBQyxRQUFRLEVBQUU7Q0FDMUMsQ0FBQyxDQUFDO0FBT0gsbUNBQW1DO0FBQ3RCLFFBQUEsaUJBQWlCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUN4QyxVQUFVLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLHdCQUF3QjtJQUNoRCxFQUFFLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLGtCQUFrQjtJQUNsQyxRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNwQixRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNwQixPQUFPLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUM5QixNQUFNLEVBQUUsMkJBQW1CO0lBQzNCLFNBQVMsRUFBRSw4QkFBc0I7SUFDakMsZUFBZSxFQUFFLDRCQUFvQixDQUFDLFFBQVEsRUFBRTtJQUNoRCxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNoQixXQUFXLEVBQUUsT0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxVQUFVO0lBQ3ZELElBQUksRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLE9BQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRTtJQUNsQyxlQUFlLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUN0QyxpQkFBaUI7SUFDakIsTUFBTSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRSwrQkFBK0I7SUFDOUQsTUFBTSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxLQUFLO0lBQ3BDLE1BQU0sRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLEVBQUUsVUFBVTtJQUN6QyxNQUFNLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUs7Q0FDckMsQ0FBQyxDQUFDO0FBSUgsb0NBQW9DO0FBQ3ZCLFFBQUEsY0FBYyxHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDckMsRUFBRSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxXQUFXO0lBQzNCLEVBQUUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsV0FBVztJQUMzQixPQUFPLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNuQixLQUFLLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNqQixRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNwQixVQUFVLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUNqQyxXQUFXLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUU7Q0FDMUMsQ0FBQyxDQUFDO0FBSUgsZ0NBQWdDO0FBQ25CLFFBQUEseUJBQXlCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNoRCxNQUFNLEVBQUUsT0FBQyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztJQUNwQyxhQUFhLEVBQUUsT0FBQyxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztJQUNoRCxNQUFNLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNmLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFO1FBQ3BCLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1FBQy9CLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1FBQ2pDLE9BQU8sRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1FBQzlCLE1BQU0sRUFBRSwyQkFBbUI7UUFDM0IsSUFBSSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7UUFDaEIsZUFBZSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7UUFDdEMsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUMsT0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO1FBQ3RDLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDO1lBQ25CLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFO1lBQ3BCLFNBQVMsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1NBQ2pDLENBQUM7UUFDRixlQUFlLEVBQUUsNEJBQW9CLENBQUMsUUFBUSxFQUFFO0tBQ2pELENBQUM7Q0FDSCxDQUFDLENBQUM7QUFFVSxRQUFBLHFCQUFxQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDNUMsTUFBTSxFQUFFLE9BQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQ2hDLGFBQWEsRUFBRSxPQUFDLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0lBQy9DLE1BQU0sRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDO1FBQ2YsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7UUFDcEIsVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7UUFDdEIsZ0JBQWdCLEVBQUUsMkJBQW1CO1FBQ3JDLElBQUksRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFO1FBQ2hCLE9BQU8sRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDO1lBQ2hCLEdBQUcsRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO1lBQzVDLEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO1lBQzlDLElBQUksRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBUyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO1NBQ3JELENBQUM7UUFDRixlQUFlLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtRQUN0QyxRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUU7S0FDdkMsQ0FBQztDQUNILENBQUMsQ0FBQztBQUVVLFFBQUEscUJBQXFCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUM1QyxNQUFNLEVBQUUsT0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFDaEMsYUFBYSxFQUFFLE9BQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQ3ZDLE1BQU0sRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDO1FBQ2YsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7UUFDcEIsVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7UUFDakMsS0FBSyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUU7UUFDakIsS0FBSyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7UUFDNUIsT0FBTyxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUMsT0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO0tBQ3RDLENBQUM7Q0FDSCxDQUFDLENBQUM7QUFFVSxRQUFBLHFCQUFxQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDNUMsTUFBTSxFQUFFLE9BQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQ2hDLGFBQWEsRUFBRSxPQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztJQUN2QyxNQUFNLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNmLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFO1FBQ3BCLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1FBQ2pDLFNBQVMsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFO1FBQ3JCLFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1FBQ2xDLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLE9BQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRTtLQUN2QyxDQUFDO0NBQ0gsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5cbi8vIE1lc3NhZ2Ugc291cmNlIHR5cGVzXG5leHBvcnQgY29uc3QgTWVzc2FnZVNvdXJjZVNjaGVtYSA9IHouZW51bShbJ3NtcycsICdlbWFpbCcsICdjaGF0JywgJ2FwaScsICdhZ2VudCddKTtcbmV4cG9ydCB0eXBlIE1lc3NhZ2VTb3VyY2UgPSB6LmluZmVyPHR5cGVvZiBNZXNzYWdlU291cmNlU2NoZW1hPjtcblxuLy8gTWVzc2FnZSBkaXJlY3Rpb24gdHlwZXNcbmV4cG9ydCBjb25zdCBNZXNzYWdlRGlyZWN0aW9uU2NoZW1hID0gei5lbnVtKFsnaW5ib3VuZCcsICdvdXRib3VuZCddKTtcbmV4cG9ydCB0eXBlIE1lc3NhZ2VEaXJlY3Rpb24gPSB6LmluZmVyPHR5cGVvZiBNZXNzYWdlRGlyZWN0aW9uU2NoZW1hPjtcblxuLy8gQ2hhbm5lbCBjb250ZXh0IHNjaGVtYXNcbmV4cG9ydCBjb25zdCBTbXNDaGFubmVsQ29udGV4dFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZnJvbTogei5zdHJpbmcoKSxcbiAgdG86IHouc3RyaW5nKCksXG4gIG1lc3NhZ2VJZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBFbWFpbENoYW5uZWxDb250ZXh0U2NoZW1hID0gei5vYmplY3Qoe1xuICBmcm9tOiB6LnN0cmluZygpLFxuICB0bzogei5zdHJpbmcoKSxcbiAgbXNnSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgdGhyZWFkSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgQ2hhdENoYW5uZWxDb250ZXh0U2NoZW1hID0gei5vYmplY3Qoe1xuICBzZXNzaW9uSWQ6IHouc3RyaW5nKCksXG4gIGNsaWVudElkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHVzZXJBZ2VudDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBpcEFkZHJlc3M6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgQ2hhbm5lbENvbnRleHRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHNtczogU21zQ2hhbm5lbENvbnRleHRTY2hlbWEub3B0aW9uYWwoKSxcbiAgZW1haWw6IEVtYWlsQ2hhbm5lbENvbnRleHRTY2hlbWEub3B0aW9uYWwoKSxcbiAgY2hhdDogQ2hhdENoYW5uZWxDb250ZXh0U2NoZW1hLm9wdGlvbmFsKCksXG59KTtcblxuZXhwb3J0IHR5cGUgU21zQ2hhbm5lbENvbnRleHQgPSB6LmluZmVyPHR5cGVvZiBTbXNDaGFubmVsQ29udGV4dFNjaGVtYT47XG5leHBvcnQgdHlwZSBFbWFpbENoYW5uZWxDb250ZXh0ID0gei5pbmZlcjx0eXBlb2YgRW1haWxDaGFubmVsQ29udGV4dFNjaGVtYT47XG5leHBvcnQgdHlwZSBDaGF0Q2hhbm5lbENvbnRleHQgPSB6LmluZmVyPHR5cGVvZiBDaGF0Q2hhbm5lbENvbnRleHRTY2hlbWE+O1xuZXhwb3J0IHR5cGUgQ2hhbm5lbENvbnRleHQgPSB6LmluZmVyPHR5cGVvZiBDaGFubmVsQ29udGV4dFNjaGVtYT47XG5cbi8vIE1lc3NhZ2UgaXRlbSBzY2hlbWEgZm9yIER5bmFtb0RCXG5leHBvcnQgY29uc3QgTWVzc2FnZUl0ZW1TY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGNvbnRhY3RfcGs6IHouc3RyaW5nKCksIC8vIHt0ZW5hbnRJZH0je2VtYWlsX2xjfVxuICB0czogei5zdHJpbmcoKSwgLy8gSVNPODYwMSBvciBVTElEXG4gIHRlbmFudElkOiB6LnN0cmluZygpLFxuICBlbWFpbF9sYzogei5zdHJpbmcoKSxcbiAgbGVhZF9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBzb3VyY2U6IE1lc3NhZ2VTb3VyY2VTY2hlbWEsXG4gIGRpcmVjdGlvbjogTWVzc2FnZURpcmVjdGlvblNjaGVtYSxcbiAgY2hhbm5lbF9jb250ZXh0OiBDaGFubmVsQ29udGV4dFNjaGVtYS5vcHRpb25hbCgpLFxuICB0ZXh0OiB6LnN0cmluZygpLFxuICBhdHRhY2htZW50czogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLCAvLyBTMyBVUklzXG4gIG1ldGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gIGNvbnZlcnNhdGlvbl9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAvLyBHU0kgYXR0cmlidXRlc1xuICBHU0kxUEs6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gdGVuYW50SWQgZm9yIHJlY2VudCBtZXNzYWdlc1xuICBHU0kxU0s6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gdHNcbiAgR1NJMlBLOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIGxlYWRfaWRcbiAgR1NJMlNLOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIHRzXG59KTtcblxuZXhwb3J0IHR5cGUgTWVzc2FnZUl0ZW0gPSB6LmluZmVyPHR5cGVvZiBNZXNzYWdlSXRlbVNjaGVtYT47XG5cbi8vIExlYWQgaXRlbSBzY2hlbWEgKGV4aXN0aW5nIHRhYmxlKVxuZXhwb3J0IGNvbnN0IExlYWRJdGVtU2NoZW1hID0gei5vYmplY3Qoe1xuICBQSzogei5zdHJpbmcoKSwgLy8gdGVuYW50SWRcbiAgU0s6IHouc3RyaW5nKCksIC8vIGVtYWlsX2xjXG4gIGxlYWRfaWQ6IHouc3RyaW5nKCksXG4gIGVtYWlsOiB6LnN0cmluZygpLFxuICBlbWFpbF9sYzogei5zdHJpbmcoKSxcbiAgcGhvbmVfZTE2NDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBwcmVmZXJlbmNlczogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgdHlwZSBMZWFkSXRlbSA9IHouaW5mZXI8dHlwZW9mIExlYWRJdGVtU2NoZW1hPjtcblxuLy8gRXZlbnQgc2NoZW1hcyBmb3IgRXZlbnRCcmlkZ2VcbmV4cG9ydCBjb25zdCBJbmJvdW5kTWVzc2FnZUV2ZW50U2NoZW1hID0gei5vYmplY3Qoe1xuICBzb3VyY2U6IHoubGl0ZXJhbCgna3hnZW4ubWVzc2FnaW5nJyksXG4gICdkZXRhaWwtdHlwZSc6IHoubGl0ZXJhbCgnbGVhZC5tZXNzYWdlLmNyZWF0ZWQnKSxcbiAgZGV0YWlsOiB6Lm9iamVjdCh7XG4gICAgdGVuYW50SWQ6IHouc3RyaW5nKCksXG4gICAgZW1haWxfbGM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwaG9uZV9lMTY0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgbGVhZF9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHNvdXJjZTogTWVzc2FnZVNvdXJjZVNjaGVtYSxcbiAgICB0ZXh0OiB6LnN0cmluZygpLFxuICAgIGNvbnZlcnNhdGlvbl9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHByb3ZpZGVyOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgIHRpbWVzdGFtcHM6IHoub2JqZWN0KHtcbiAgICAgIHJlY2VpdmVkOiB6LnN0cmluZygpLFxuICAgICAgcHJvY2Vzc2VkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgfSksXG4gICAgY2hhbm5lbF9jb250ZXh0OiBDaGFubmVsQ29udGV4dFNjaGVtYS5vcHRpb25hbCgpLFxuICB9KSxcbn0pO1xuXG5leHBvcnQgY29uc3QgQWdlbnRSZXBseUV2ZW50U2NoZW1hID0gei5vYmplY3Qoe1xuICBzb3VyY2U6IHoubGl0ZXJhbCgna3hnZW4uYWdlbnQnKSxcbiAgJ2RldGFpbC10eXBlJzogei5saXRlcmFsKCdhZ2VudC5yZXBseS5jcmVhdGVkJyksXG4gIGRldGFpbDogei5vYmplY3Qoe1xuICAgIHRlbmFudElkOiB6LnN0cmluZygpLFxuICAgIGNvbnRhY3RfcGs6IHouc3RyaW5nKCksXG4gICAgcHJlZmVycmVkQ2hhbm5lbDogTWVzc2FnZVNvdXJjZVNjaGVtYSxcbiAgICB0ZXh0OiB6LnN0cmluZygpLFxuICAgIHJvdXRpbmc6IHoub2JqZWN0KHtcbiAgICAgIHNtczogei5vYmplY3QoeyB0bzogei5zdHJpbmcoKSB9KS5vcHRpb25hbCgpLFxuICAgICAgZW1haWw6IHoub2JqZWN0KHsgdG86IHouc3RyaW5nKCkgfSkub3B0aW9uYWwoKSxcbiAgICAgIGNoYXQ6IHoub2JqZWN0KHsgc2Vzc2lvbklkOiB6LnN0cmluZygpIH0pLm9wdGlvbmFsKCksXG4gICAgfSksXG4gICAgY29udmVyc2F0aW9uX2lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gIH0pLFxufSk7XG5cbmV4cG9ydCBjb25zdCBBZ2VudEVycm9yRXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHNvdXJjZTogei5saXRlcmFsKCdreGdlbi5hZ2VudCcpLFxuICAnZGV0YWlsLXR5cGUnOiB6LmxpdGVyYWwoJ2FnZW50LmVycm9yJyksXG4gIGRldGFpbDogei5vYmplY3Qoe1xuICAgIHRlbmFudElkOiB6LnN0cmluZygpLFxuICAgIGNvbnRhY3RfcGs6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBlcnJvcjogei5zdHJpbmcoKSxcbiAgICBzdGFjazogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIGNvbnRleHQ6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gIH0pLFxufSk7XG5cbmV4cG9ydCBjb25zdCBBZ2VudFRyYWNlRXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHNvdXJjZTogei5saXRlcmFsKCdreGdlbi5hZ2VudCcpLFxuICAnZGV0YWlsLXR5cGUnOiB6LmxpdGVyYWwoJ2FnZW50LnRyYWNlJyksXG4gIGRldGFpbDogei5vYmplY3Qoe1xuICAgIHRlbmFudElkOiB6LnN0cmluZygpLFxuICAgIGNvbnRhY3RfcGs6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBvcGVyYXRpb246IHouc3RyaW5nKCksXG4gICAgZHVyYXRpb25fbXM6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICBtZXRhZGF0YTogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKSxcbiAgfSksXG59KTtcblxuZXhwb3J0IHR5cGUgSW5ib3VuZE1lc3NhZ2VFdmVudCA9IHouaW5mZXI8dHlwZW9mIEluYm91bmRNZXNzYWdlRXZlbnRTY2hlbWE+O1xuZXhwb3J0IHR5cGUgQWdlbnRSZXBseUV2ZW50ID0gei5pbmZlcjx0eXBlb2YgQWdlbnRSZXBseUV2ZW50U2NoZW1hPjtcbmV4cG9ydCB0eXBlIEFnZW50RXJyb3JFdmVudCA9IHouaW5mZXI8dHlwZW9mIEFnZW50RXJyb3JFdmVudFNjaGVtYT47XG5leHBvcnQgdHlwZSBBZ2VudFRyYWNlRXZlbnQgPSB6LmluZmVyPHR5cGVvZiBBZ2VudFRyYWNlRXZlbnRTY2hlbWE+O1xuXG4vLyBBZ2VudCBjb250ZXh0IGZvciBwcm9jZXNzaW5nXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50Q29udGV4dCB7XG4gIHRlbmFudElkOiBzdHJpbmc7XG4gIGVtYWlsX2xjOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgc291cmNlOiBNZXNzYWdlU291cmNlO1xuICBjaGFubmVsX2NvbnRleHQ/OiBDaGFubmVsQ29udGV4dDtcbiAgbGVhZF9pZD86IHN0cmluZztcbiAgY29udmVyc2F0aW9uX2lkPzogc3RyaW5nO1xufVxuXG4vLyBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFJ1bnRpbWVDb25maWcge1xuICBtZXNzYWdlc1RhYmxlOiBzdHJpbmc7XG4gIGxlYWRzVGFibGU6IHN0cmluZztcbiAgcGVyc29uYXNUYWJsZT86IHN0cmluZztcbiAgYmVkcm9ja01vZGVsSWQ6IHN0cmluZztcbiAgb3V0Ym91bmRFdmVudEJ1c05hbWU/OiBzdHJpbmc7XG4gIG91dGJvdW5kRXZlbnRCdXNBcm4/OiBzdHJpbmc7XG4gIGV2ZW50QnVzUHV0RXZlbnRzUm9sZUFybj86IHN0cmluZztcbiAgcmFnSW5kZXhOYW1lUHJlZml4Pzogc3RyaW5nO1xuICBoaXN0b3J5TGltaXQ6IG51bWJlcjtcbiAgYXdzUmVnaW9uOiBzdHJpbmc7XG4gIGR5bmFtb2RiRW5kcG9pbnQ/OiBzdHJpbmc7IC8vIGZvciBsb2NhbCBkZXZlbG9wbWVudFxufVxuXG4vLyBTdHJ1Y3R1cmVkIHJlc3BvbnNlIGZvciBMYW1iZGEvQVBJIHJlc3BvbnNlc1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudFJlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBpbnRlbnQ/OiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgY29uZmlkZW5jZTogbnVtYmVyO1xuICAgIHByaW9yaXR5OiBzdHJpbmc7XG4gICAgbWF0Y2hlZFRyaWdnZXJzOiBzdHJpbmdbXTtcbiAgICBtYXRjaGVkUGF0dGVybnM6IHN0cmluZ1tdO1xuICAgIGFjdGlvbnM/OiBzdHJpbmdbXTtcbiAgfTtcbiAgbWV0YWRhdGE6IHtcbiAgICBzZXNzaW9uSWQ6IHN0cmluZztcbiAgICB0ZW5hbnRJZDogc3RyaW5nO1xuICAgIHVzZXJJZD86IHN0cmluZztcbiAgICBjaGFubmVsPzogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICAgIHByb2Nlc3NpbmdUaW1lTXM6IG51bWJlcjtcbiAgICB0b3RhbFByb2Nlc3NpbmdUaW1lTXM/OiBudW1iZXI7XG4gICAgcmVzcG9uc2VDaHVua3M/OiBudW1iZXI7XG4gICAgcGVyc29uYUlkPzogc3RyaW5nO1xuICAgIGNvbXBhbnlOYW1lPzogc3RyaW5nO1xuICB9O1xuICBmb2xsb3dVcD86IHN0cmluZ1tdO1xuICBlcnJvcj86IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGRldGFpbHM/OiBhbnk7XG4gIH07XG59XG4iXX0=