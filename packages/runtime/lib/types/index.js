"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AgentTraceEventSchema = exports.AgentErrorEventSchema = exports.AgentReplyEventSchema = exports.InboundMessageEventSchema = exports.LeadItemSchema = exports.MessageItemSchema = exports.ChannelContextSchema = exports.ChatChannelContextSchema = exports.EmailChannelContextSchema = exports.SmsChannelContextSchema = exports.MessageDirectionSchema = exports.MessageSourceSchema = void 0;
const zod_1 = require("zod");
// Message source types
exports.MessageSourceSchema = zod_1.z.enum(['sms', 'email', 'chat', 'api', 'agent']);
// Message direction types
exports.MessageDirectionSchema = zod_1.z.enum(['inbound', 'outbound']);
// Channel context schemas
exports.SmsChannelContextSchema = zod_1.z.object({
    from: zod_1.z.string(),
    to: zod_1.z.string(),
    messageId: zod_1.z.string().optional(),
});
exports.EmailChannelContextSchema = zod_1.z.object({
    from: zod_1.z.string(),
    to: zod_1.z.string(),
    msgId: zod_1.z.string().optional(),
    threadId: zod_1.z.string().optional(),
});
exports.ChatChannelContextSchema = zod_1.z.object({
    sessionId: zod_1.z.string(),
    clientId: zod_1.z.string().optional(),
    userAgent: zod_1.z.string().optional(),
    ipAddress: zod_1.z.string().optional(),
    connectionId: zod_1.z.string().optional(),
});
exports.ChannelContextSchema = zod_1.z.object({
    sms: exports.SmsChannelContextSchema.optional(),
    email: exports.EmailChannelContextSchema.optional(),
    chat: exports.ChatChannelContextSchema.optional(),
});
// Message item schema for DynamoDB
exports.MessageItemSchema = zod_1.z.object({
    contact_pk: zod_1.z.string(), // {tenantId}#{email_lc}
    ts: zod_1.z.string(), // ISO8601 or ULID
    tenantId: zod_1.z.string(),
    email_lc: zod_1.z.string(),
    lead_id: zod_1.z.string().optional(),
    source: exports.MessageSourceSchema,
    direction: exports.MessageDirectionSchema,
    channel_context: exports.ChannelContextSchema.optional(),
    text: zod_1.z.string(),
    attachments: zod_1.z.array(zod_1.z.string()).optional(), // S3 URIs
    meta: zod_1.z.record(zod_1.z.any()).optional(),
    conversation_id: zod_1.z.string().optional(),
    // Consumer table fields
    targetKey: zod_1.z.string().optional(), // channel#{channelId} or contact_pk
    dateReceived: zod_1.z.string().optional(), // ISO8601 timestamp
    // GSI attributes
    GSI1PK: zod_1.z.string().optional(), // tenantId for recent messages
    GSI1SK: zod_1.z.string().optional(), // ts
    GSI2PK: zod_1.z.string().optional(), // lead_id
    GSI2SK: zod_1.z.string().optional(), // ts
});
// Lead item schema (existing table)
exports.LeadItemSchema = zod_1.z.object({
    PK: zod_1.z.string(), // tenantId
    SK: zod_1.z.string(), // email_lc
    lead_id: zod_1.z.string(),
    email: zod_1.z.string(),
    email_lc: zod_1.z.string(),
    phone_e164: zod_1.z.string().optional(),
    preferences: zod_1.z.record(zod_1.z.any()).optional(),
});
// Event schemas for EventBridge
exports.InboundMessageEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.messaging'),
    'detail-type': zod_1.z.literal('lead.message.created'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        email_lc: zod_1.z.string().optional(),
        phone_e164: zod_1.z.string().optional(),
        lead_id: zod_1.z.string().optional(),
        source: exports.MessageSourceSchema,
        text: zod_1.z.string(),
        conversation_id: zod_1.z.string().optional(),
        provider: zod_1.z.record(zod_1.z.any()).optional(),
        timestamps: zod_1.z.object({
            received: zod_1.z.string(),
            processed: zod_1.z.string().optional(),
        }),
        channel_context: exports.ChannelContextSchema.optional(),
    }),
});
exports.AgentReplyEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.agent'),
    'detail-type': zod_1.z.literal('agent.reply.created'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        contact_pk: zod_1.z.string(),
        preferredChannel: exports.MessageSourceSchema,
        text: zod_1.z.string(),
        routing: zod_1.z.object({
            sms: zod_1.z.object({ to: zod_1.z.string() }).optional(),
            email: zod_1.z.object({ to: zod_1.z.string() }).optional(),
            chat: zod_1.z.object({ sessionId: zod_1.z.string() }).optional(),
        }),
        conversation_id: zod_1.z.string().optional(),
        metadata: zod_1.z.record(zod_1.z.any()).optional(),
    }),
});
exports.AgentErrorEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.agent'),
    'detail-type': zod_1.z.literal('agent.error'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        contact_pk: zod_1.z.string().optional(),
        error: zod_1.z.string(),
        stack: zod_1.z.string().optional(),
        context: zod_1.z.record(zod_1.z.any()).optional(),
    }),
});
exports.AgentTraceEventSchema = zod_1.z.object({
    source: zod_1.z.literal('kxgen.agent'),
    'detail-type': zod_1.z.literal('agent.trace'),
    detail: zod_1.z.object({
        tenantId: zod_1.z.string(),
        contact_pk: zod_1.z.string().optional(),
        operation: zod_1.z.string(),
        duration_ms: zod_1.z.number().optional(),
        metadata: zod_1.z.record(zod_1.z.any()).optional(),
    }),
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdHlwZXMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkJBQXdCO0FBRXhCLHVCQUF1QjtBQUNWLFFBQUEsbUJBQW1CLEdBQUcsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0FBR3BGLDBCQUEwQjtBQUNiLFFBQUEsc0JBQXNCLEdBQUcsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBR3RFLDBCQUEwQjtBQUNiLFFBQUEsdUJBQXVCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUM5QyxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNoQixFQUFFLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNkLFNBQVMsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQ2pDLENBQUMsQ0FBQztBQUVVLFFBQUEseUJBQXlCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNoRCxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNoQixFQUFFLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNkLEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQzVCLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQ2hDLENBQUMsQ0FBQztBQUVVLFFBQUEsd0JBQXdCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUMvQyxTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNyQixRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUMvQixTQUFTLEVB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RSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO1FBQzVCLE9BQU8sRUFBRSxPQUFDLENBQUMsTUFBTSxDQUFDLE9BQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFFBQVEsRUFBRTtLQUN0QyxDQUFDO0NBQ0gsQ0FBQyxDQUFDO0FBRVUsUUFBQSxxQkFBcUIsR0FBRyxPQUFDLENBQUMsTUFBTSxDQUFDO0lBQzVDLE1BQU0sRUFBRSxPQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztJQUNoQyxhQUFhLEVBQUUsT0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFDdkMsTUFBTSxFQUFFLE9BQUMsQ0FBQyxNQUFNLENBQUM7UUFDZixRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtRQUNwQixVQUFVLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtRQUNqQyxTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtRQUNyQixXQUFXLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtRQUNsQyxRQUFRLEVBQUUsT0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUU7S0FDdkMsQ0FBQztDQUNILENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG4vLyBNZXNzYWdlIHNvdXJjZSB0eXBlc1xuZXhwb3J0IGNvbnN0IE1lc3NhZ2VTb3VyY2VTY2hlbWEgPSB6LmVudW0oWydzbXMnLCAnZW1haWwnLCAnY2hhdCcsICdhcGknLCAnYWdlbnQnXSk7XG5leHBvcnQgdHlwZSBNZXNzYWdlU291cmNlID0gei5pbmZlcjx0eXBlb2YgTWVzc2FnZVNvdXJjZVNjaGVtYT47XG5cbi8vIE1lc3NhZ2UgZGlyZWN0aW9uIHR5cGVzXG5leHBvcnQgY29uc3QgTWVzc2FnZURpcmVjdGlvblNjaGVtYSA9IHouZW51bShbJ2luYm91bmQnLCAnb3V0Ym91bmQnXSk7XG5leHBvcnQgdHlwZSBNZXNzYWdlRGlyZWN0aW9uID0gei5pbmZlcjx0eXBlb2YgTWVzc2FnZURpcmVjdGlvblNjaGVtYT47XG5cbi8vIENoYW5uZWwgY29udGV4dCBzY2hlbWFzXG5leHBvcnQgY29uc3QgU21zQ2hhbm5lbENvbnRleHRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGZyb206IHouc3RyaW5nKCksXG4gIHRvOiB6LnN0cmluZygpLFxuICBtZXNzYWdlSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgRW1haWxDaGFubmVsQ29udGV4dFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgZnJvbTogei5zdHJpbmcoKSxcbiAgdG86IHouc3RyaW5nKCksXG4gIG1zZ0lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHRocmVhZElkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG59KTtcblxuZXhwb3J0IGNvbnN0IENoYXRDaGFubmVsQ29udGV4dFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgc2Vzc2lvbklkOiB6LnN0cmluZygpLFxuICBjbGllbnRJZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB1c2VyQWdlbnQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgaXBBZGRyZXNzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGNvbm5lY3Rpb25JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBDaGFubmVsQ29udGV4dFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgc21zOiBTbXNDaGFubmVsQ29udGV4dFNjaGVtYS5vcHRpb25hbCgpLFxuICBlbWFpbDogRW1haWxDaGFubmVsQ29udGV4dFNjaGVtYS5vcHRpb25hbCgpLFxuICBjaGF0OiBDaGF0Q2hhbm5lbENvbnRleHRTY2hlbWEub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgdHlwZSBTbXNDaGFubmVsQ29udGV4dCA9IHouaW5mZXI8dHlwZW9mIFNtc0NoYW5uZWxDb250ZXh0U2NoZW1hPjtcbmV4cG9ydCB0eXBlIEVtYWlsQ2hhbm5lbENvbnRleHQgPSB6LmluZmVyPHR5cGVvZiBFbWFpbENoYW5uZWxDb250ZXh0U2NoZW1hPjtcbmV4cG9ydCB0eXBlIENoYXRDaGFubmVsQ29udGV4dCA9IHouaW5mZXI8dHlwZW9mIENoYXRDaGFubmVsQ29udGV4dFNjaGVtYT47XG5leHBvcnQgdHlwZSBDaGFubmVsQ29udGV4dCA9IHouaW5mZXI8dHlwZW9mIENoYW5uZWxDb250ZXh0U2NoZW1hPjtcblxuLy8gTWVzc2FnZSBpdGVtIHNjaGVtYSBmb3IgRHluYW1vREJcbmV4cG9ydCBjb25zdCBNZXNzYWdlSXRlbVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgY29udGFjdF9wazogei5zdHJpbmcoKSwgLy8ge3RlbmFudElkfSN7ZW1haWxfbGN9XG4gIHRzOiB6LnN0cmluZygpLCAvLyBJU084NjAxIG9yIFVMSURcbiAgdGVuYW50SWQ6IHouc3RyaW5nKCksXG4gIGVtYWlsX2xjOiB6LnN0cmluZygpLFxuICBsZWFkX2lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHNvdXJjZTogTWVzc2FnZVNvdXJjZVNjaGVtYSxcbiAgZGlyZWN0aW9uOiBNZXNzYWdlRGlyZWN0aW9uU2NoZW1hLFxuICBjaGFubmVsX2NvbnRleHQ6IENoYW5uZWxDb250ZXh0U2NoZW1hLm9wdGlvbmFsKCksXG4gIHRleHQ6IHouc3RyaW5nKCksXG4gIGF0dGFjaG1lbnRzOiB6LmFycmF5KHouc3RyaW5nKCkpLm9wdGlvbmFsKCksIC8vIFMzIFVSSXNcbiAgbWV0YTogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKSxcbiAgY29udmVyc2F0aW9uX2lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIC8vIENvbnN1bWVyIHRhYmxlIGZpZWxkc1xuICB0YXJnZXRLZXk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gY2hhbm5lbCN7Y2hhbm5lbElkfSBvciBjb250YWN0X3BrXG4gIGRhdGVSZWNlaXZlZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLCAvLyBJU084NjAxIHRpbWVzdGFtcFxuICAvLyBHU0kgYXR0cmlidXRlc1xuICBHU0kxUEs6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gdGVuYW50SWQgZm9yIHJlY2VudCBtZXNzYWdlc1xuICBHU0kxU0s6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gdHNcbiAgR1NJMlBLOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIGxlYWRfaWRcbiAgR1NJMlNLOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIHRzXG59KTtcblxuZXhwb3J0IHR5cGUgTWVzc2FnZUl0ZW0gPSB6LmluZmVyPHR5cGVvZiBNZXNzYWdlSXRlbVNjaGVtYT47XG5cbi8vIExlYWQgaXRlbSBzY2hlbWEgKGV4aXN0aW5nIHRhYmxlKVxuZXhwb3J0IGNvbnN0IExlYWRJdGVtU2NoZW1hID0gei5vYmplY3Qoe1xuICBQSzogei5zdHJpbmcoKSwgLy8gdGVuYW50SWRcbiAgU0s6IHouc3RyaW5nKCksIC8vIGVtYWlsX2xjXG4gIGxlYWRfaWQ6IHouc3RyaW5nKCksXG4gIGVtYWlsOiB6LnN0cmluZygpLFxuICBlbWFpbF9sYzogei5zdHJpbmcoKSxcbiAgcGhvbmVfZTE2NDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBwcmVmZXJlbmNlczogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgdHlwZSBMZWFkSXRlbSA9IHouaW5mZXI8dHlwZW9mIExlYWRJdGVtU2NoZW1hPjtcblxuLy8gRXZlbnQgc2NoZW1hcyBmb3IgRXZlbnRCcmlkZ2VcbmV4cG9ydCBjb25zdCBJbmJvdW5kTWVzc2FnZUV2ZW50U2NoZW1hID0gei5vYmplY3Qoe1xuICBzb3VyY2U6IHoubGl0ZXJhbCgna3hnZW4ubWVzc2FnaW5nJyksXG4gICdkZXRhaWwtdHlwZSc6IHoubGl0ZXJhbCgnbGVhZC5tZXNzYWdlLmNyZWF0ZWQnKSxcbiAgZGV0YWlsOiB6Lm9iamVjdCh7XG4gICAgdGVuYW50SWQ6IHouc3RyaW5nKCksXG4gICAgZW1haWxfbGM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBwaG9uZV9lMTY0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgbGVhZF9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHNvdXJjZTogTWVzc2FnZVNvdXJjZVNjaGVtYSxcbiAgICB0ZXh0OiB6LnN0cmluZygpLFxuICAgIGNvbnZlcnNhdGlvbl9pZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIHByb3ZpZGVyOiB6LnJlY29yZCh6LmFueSgpKS5vcHRpb25hbCgpLFxuICAgIHRpbWVzdGFtcHM6IHoub2JqZWN0KHtcbiAgICAgIHJlY2VpdmVkOiB6LnN0cmluZygpLFxuICAgICAgcHJvY2Vzc2VkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgfSksXG4gICAgY2hhbm5lbF9jb250ZXh0OiBDaGFubmVsQ29udGV4dFNjaGVtYS5vcHRpb25hbCgpLFxuICB9KSxcbn0pO1xuXG5leHBvcnQgY29uc3QgQWdlbnRSZXBseUV2ZW50U2NoZW1hID0gei5vYmplY3Qoe1xuICBzb3VyY2U6IHoubGl0ZXJhbCgna3hnZW4uYWdlbnQnKSxcbiAgJ2RldGFpbC10eXBlJzogei5saXRlcmFsKCdhZ2VudC5yZXBseS5jcmVhdGVkJyksXG4gIGRldGFpbDogei5vYmplY3Qoe1xuICAgIHRlbmFudElkOiB6LnN0cmluZygpLFxuICAgIGNvbnRhY3RfcGs6IHouc3RyaW5nKCksXG4gICAgcHJlZmVycmVkQ2hhbm5lbDogTWVzc2FnZVNvdXJjZVNjaGVtYSxcbiAgICB0ZXh0OiB6LnN0cmluZygpLFxuICAgIHJvdXRpbmc6IHoub2JqZWN0KHtcbiAgICAgIHNtczogei5vYmplY3QoeyB0bzogei5zdHJpbmcoKSB9KS5vcHRpb25hbCgpLFxuICAgICAgZW1haWw6IHoub2JqZWN0KHsgdG86IHouc3RyaW5nKCkgfSkub3B0aW9uYWwoKSxcbiAgICAgIGNoYXQ6IHoub2JqZWN0KHsgc2Vzc2lvbklkOiB6LnN0cmluZygpIH0pLm9wdGlvbmFsKCksXG4gICAgfSksXG4gICAgY29udmVyc2F0aW9uX2lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgbWV0YWRhdGE6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gIH0pLFxufSk7XG5cbmV4cG9ydCBjb25zdCBBZ2VudEVycm9yRXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHNvdXJjZTogei5saXRlcmFsKCdreGdlbi5hZ2VudCcpLFxuICAnZGV0YWlsLXR5cGUnOiB6LmxpdGVyYWwoJ2FnZW50LmVycm9yJyksXG4gIGRldGFpbDogei5vYmplY3Qoe1xuICAgIHRlbmFudElkOiB6LnN0cmluZygpLFxuICAgIGNvbnRhY3RfcGs6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBlcnJvcjogei5zdHJpbmcoKSxcbiAgICBzdGFjazogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICAgIGNvbnRleHQ6IHoucmVjb3JkKHouYW55KCkpLm9wdGlvbmFsKCksXG4gIH0pLFxufSk7XG5cbmV4cG9ydCBjb25zdCBBZ2VudFRyYWNlRXZlbnRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHNvdXJjZTogei5saXRlcmFsKCdreGdlbi5hZ2VudCcpLFxuICAnZGV0YWlsLXR5cGUnOiB6LmxpdGVyYWwoJ2FnZW50LnRyYWNlJyksXG4gIGRldGFpbDogei5vYmplY3Qoe1xuICAgIHRlbmFudElkOiB6LnN0cmluZygpLFxuICAgIGNvbnRhY3RfcGs6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBvcGVyYXRpb246IHouc3RyaW5nKCksXG4gICAgZHVyYXRpb25fbXM6IHoubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICBtZXRhZGF0YTogei5yZWNvcmQoei5hbnkoKSkub3B0aW9uYWwoKSxcbiAgfSksXG59KTtcblxuZXhwb3J0IHR5cGUgSW5ib3VuZE1lc3NhZ2VFdmVudCA9IHouaW5mZXI8dHlwZW9mIEluYm91bmRNZXNzYWdlRXZlbnRTY2hlbWE+O1xuZXhwb3J0IHR5cGUgQWdlbnRSZXBseUV2ZW50ID0gei5pbmZlcjx0eXBlb2YgQWdlbnRSZXBseUV2ZW50U2NoZW1hPjtcbmV4cG9ydCB0eXBlIEFnZW50RXJyb3JFdmVudCA9IHouaW5mZXI8dHlwZW9mIEFnZW50RXJyb3JFdmVudFNjaGVtYT47XG5leHBvcnQgdHlwZSBBZ2VudFRyYWNlRXZlbnQgPSB6LmluZmVyPHR5cGVvZiBBZ2VudFRyYWNlRXZlbnRTY2hlbWE+O1xuXG4vLyBBZ2VudCBjb250ZXh0IGZvciBwcm9jZXNzaW5nXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50Q29udGV4dCB7XG4gIHRlbmFudElkOiBzdHJpbmc7XG4gIGVtYWlsX2xjOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgc291cmNlOiBNZXNzYWdlU291cmNlO1xuICBjaGFubmVsX2NvbnRleHQ/OiBDaGFubmVsQ29udGV4dDtcbiAgbGVhZF9pZD86IHN0cmluZztcbiAgY29udmVyc2F0aW9uX2lkPzogc3RyaW5nO1xuICAvLyBDaGF0LXNwZWNpZmljIGZpZWxkcyBmb3IgcmVzcG9uc2UgZW1pc3Npb25cbiAgY2hhbm5lbElkPzogc3RyaW5nO1xuICB1c2VySWQ/OiBzdHJpbmc7IC8vIFBlcnNvbmEgSUQgKHRoZSBhZ2VudClcbiAgc2VuZGVySWQ/OiBzdHJpbmc7IC8vIFVzZXIgSUQgKHRoZSBodW1hbiBzZW5kZXIpXG4gIHVzZXJOYW1lPzogc3RyaW5nO1xuICBjb25uZWN0aW9uSWQ/OiBzdHJpbmc7IC8vIFdlYlNvY2tldCBjb25uZWN0aW9uIElEIGZvciBkaXJlY3QgcmVzcG9uc2Ugcm91dGluZ1xufVxuXG4vLyBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXG5leHBvcnQgaW50ZXJmYWNlIFJ1bnRpbWVDb25maWcge1xuICBtZXNzYWdlc1RhYmxlOiBzdHJpbmc7XG4gIGxlYWRzVGFibGU6IHN0cmluZztcbiAgcGVyc29uYXNUYWJsZT86IHN0cmluZztcbiAgYmVkcm9ja01vZGVsSWQ6IHN0cmluZztcbiAgb3V0Ym91bmRFdmVudEJ1c05hbWU/OiBzdHJpbmc7XG4gIG91dGJvdW5kRXZlbnRCdXNBcm4/OiBzdHJpbmc7XG4gIGV2ZW50QnVzUHV0RXZlbnRzUm9sZUFybj86IHN0cmluZztcbiAgcmFnSW5kZXhOYW1lUHJlZml4Pzogc3RyaW5nO1xuICBoaXN0b3J5TGltaXQ6IG51bWJlcjtcbiAgYXdzUmVnaW9uOiBzdHJpbmc7XG4gIGR5bmFtb2RiRW5kcG9pbnQ/OiBzdHJpbmc7IC8vIGZvciBsb2NhbCBkZXZlbG9wbWVudFxufVxuXG4vLyBTdHJ1Y3R1cmVkIHJlc3BvbnNlIGZvciBMYW1iZGEvQVBJIHJlc3BvbnNlc1xuZXhwb3J0IGludGVyZmFjZSBBZ2VudFJlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBpbnRlbnQ/OiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgY29uZmlkZW5jZTogbnVtYmVyO1xuICAgIHByaW9yaXR5OiBzdHJpbmc7XG4gICAgbWF0Y2hlZFRyaWdnZXJzOiBzdHJpbmdbXTtcbiAgICBtYXRjaGVkUGF0dGVybnM6IHN0cmluZ1tdO1xuICAgIGFjdGlvbnM/OiBzdHJpbmdbXTtcbiAgfTtcbiAgbWV0YWRhdGE6IHtcbiAgICBzZXNzaW9uSWQ6IHN0cmluZztcbiAgICB0ZW5hbnRJZDogc3RyaW5nO1xuICAgIHVzZXJJZD86IHN0cmluZztcbiAgICBjaGFubmVsPzogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICAgIHByb2Nlc3NpbmdUaW1lTXM6IG51bWJlcjtcbiAgICB0b3RhbFByb2Nlc3NpbmdUaW1lTXM/OiBudW1iZXI7XG4gICAgcmVzcG9uc2VDaHVua3M/OiBudW1iZXI7XG4gICAgcGVyc29uYUlkPzogc3RyaW5nO1xuICAgIGNvbXBhbnlOYW1lPzogc3RyaW5nO1xuICB9O1xuICBmb2xsb3dVcD86IHN0cmluZ1tdO1xuICBlcnJvcj86IHtcbiAgICBjb2RlOiBzdHJpbmc7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGRldGFpbHM/OiBhbnk7XG4gIH07XG59XG5cbi8vIEV4cG9ydCB3b3JrZmxvdyBzdGF0ZSB0eXBlcyBmcm9tIGR5bmFtb2RiLXNjaGVtYXNcbmV4cG9ydCB0eXBlIHsgQ2hhbm5lbFdvcmtmbG93U3RhdGUsIENoYW5uZWxJdGVtIH0gZnJvbSBcIi4vZHluYW1vZGItc2NoZW1hcy5qc1wiO1xuIl19